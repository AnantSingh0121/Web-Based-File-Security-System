<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>{{ action }} File Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body { background-color: #f8f9fa; }
    .card { border-radius: 15px; }
    .vt-green { background-color: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
    .vt-red { background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
    .vt-yellow { background-color: #fff3cd; border: 1px solid #ffeeba; color: #856404; }
</style>
</head>
<body class="d-flex flex-column align-items-center justify-content-center py-5">

<div class="container">
    <div class="card p-4 mb-4 shadow-sm">
        <h1 class="text-center mb-4">{{ action }} File Dashboard</h1>
        <p><strong>File Name:</strong> {{ metadata.filename }}</p>
        <p><strong>Original Name:</strong> {{ metadata.original_filename }}</p>
        <p><strong>Size:</strong> {{ metadata.size }} bytes</p>
        <p><strong>SHA-256:</strong> {{ metadata.pre_sha256 }}</p>
        <p><strong>Uploaded At:</strong> {{ metadata.uploaded_at }}</p>
    </div>

    {% if metadata.vt_scan %}
    {% set status_class = "vt-yellow" %}
    {% if metadata.vt_scan.positives > 0 %}
        {% set status_class = "vt-red" %}
    {% elif metadata.vt_scan.status == "completed" and metadata.vt_scan.positives == 0 %}
        {% set status_class = "vt-green" %}
    {% endif %}
    <div class="card p-3 mb-4 {{ status_class }}">
        <h4>VirusTotal Scan</h4>
        <p><strong>Status:</strong> {{ metadata.vt_scan.status }}</p>
        <p><strong>Total Engines:</strong> {{ metadata.vt_scan.total }}</p>
        <p><strong>Positives:</strong> {{ metadata.vt_scan.positives }}</p>
    </div>
    {% endif %}

    <div class="text-center">
        <a id="download-link" href="{{ url_for('download_file', filename=filename) }}" class="btn btn-primary btn-lg">
            Download File
        </a>
    </div>
</div>

<script>
  document.getElementById('download-link').click();
</script>
</body>
</html>
